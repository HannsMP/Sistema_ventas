class Catalogue{ev=new EventListener;#a=new Map;#b="asc";#c=!1;#d={};#e=0;#f=0;#g=0;#h=0;#i=0;#j=!1;constructor(t,i,e,s=20){this.fetchCallback=i,this.factoryCallback=e,this.#f=s,t.classList.add("catalogue-content"),t.innerHTML='<div class="catalogue-header"><div class="catalogue-details"><span class="paginator-length"></span><span class="paginator-show"></span></div><div class="catalogue-controls"><button class="btn-sort"><i class="bx bx-sort-a-z"></i></button><button class="btn-visibility"><i class="bx bx-show"></i></button></div></div><div class="catalogue-grid"></div><div class="catalogue-footer"><div class="catalogue-paginator"></div></div>',this.catalogoBox=t,this.catalogoGrid=t.querySelector(".catalogue-grid"),this.paginatorLength=t.querySelector(".paginator-length"),this.paginatorShow=t.querySelector(".paginator-show"),this.catalogoPaginator=t.querySelector(".catalogue-paginator"),this.sortButton=t.querySelector(".btn-sort"),this.visibilityButton=t.querySelector(".btn-visibility"),this.sortButton.addEventListener("click",()=>this.#k().draw()),this.visibilityButton.addEventListener("click",()=>this.#l().draw())}set order(t){this.#b="asc"==t?"asc":"desc",this.#k(this.#b)}set visibility(t=!0){this.#c=!!t,this.#l(this.#c)}get orderGet(){return this.#b}get visibilityGet(){return this.#c}#k(t="asc"===this.#b?"desc":"asc"){this.#b=t,this.ev.emit("order",t);let i="asc"===this.#b?"bx-sort-a-z":"bx-sort-z-a";return this.sortButton.querySelector("i").className=`bx ${i}`,this}#l(e=!this.#c){this.#c=e,this.ev.emit("visibility",e);let s=this.#c?"bx-show":"bx-hide";return this.visibilityButton.querySelector("i").className=`bx ${s}`,this}set(t,i,e=!0){if(!this.#a.has(t))return;let s=this.#a.get(t);"function"==typeof i?i(s.data):e&&(s.data={...s.data,...i}),s.productHTML.innerHTML=this.factoryCallback(s.data)}delete(t){if(this.#a.has(t))this.#a.get(t).productHTML.remove(),this.#a.delete(t)}filter(t){return this.ev.emit("search",t),this.#d=t,this}draw(t=this.#g){this.#e++;let i={draw:this.#e,filter:this.#d,order:this.#b,visibility:this.#c,start:this.#f*t,length:this.#f};return this.ev.emit("load",i),this.fetchCallback(i,e=>{i.draw==e.draw&&(this.ev.emit("complete",e),this.#g=t,this.#h=e.recordsTotal||0,this.#i=e.recordsFiltered||0,this.#j=this.#h!=this.#i,this.#m(e),this.#n())}),this.#e}#m({data:a=[],draw:r}){let h=new Set(a.map(t=>t.id));this.#a.forEach((t,i)=>{t.productHTML.remove(),h.has(i)||this.#a.delete(i)});if(!a.every(t=>{if(r!=this.#e)return!1;let i=this.#a.has(t.id),e=i?this.#a.get(t.id).productHTML:document.createElement("div");return i||(e.classList.add("product-box"),e.id=t.id),e.innerHTML=this.factoryCallback(t),this.#a.set(t.id,{data:t,productHTML:e}),this.catalogoGrid.append(e),!0}))return;let o=this.#f*this.#g;this.#j?this.paginatorLength.innerText=`Mostrando ${o+1} a ${o+a.length}, de ${this.#i} entradas (filtrado de ${this.#h} entradas totales)`:this.paginatorLength.innerText=`Mostrando ${o+1} a ${o+a.length}, de ${this.#i} entradas`,this.paginatorShow.innerText=`Visibles ${a.length}`}#n(){let n=Math.ceil(this.#i/this.#f);this.catalogoPaginator.innerHTML="",this.catalogoPaginator.append(this.#o("Primero",()=>this.draw(0),0===this.#g)),this.catalogoPaginator.append(this.#o("Anterior",()=>this.draw(this.#g-1),0===this.#g));for(let l=Math.max(0,this.#g-2);l<=Math.min(n-1,this.#g+2);l++){let c=this.#o(l+1,()=>this.draw(l),l===this.#g);l===this.#g&&c.classList.add("active"),this.catalogoPaginator.append(c)}this.catalogoPaginator.append(this.#o("Siguiente",()=>this.draw(this.#g+1),this.#g===n-1)),this.catalogoPaginator.append(this.#o("\xdaltimo",()=>this.draw(n-1),this.#g===n-1))}#o(d,u,g=!1){let b=document.createElement("button");return b.className="pag",b.innerText=d,b.disabled=g,b.addEventListener("click",u),b}}