class DataImage{static identifier=1;constructor(t){this.file=t,this.id=DataImage.identifier,DataImage.identifier++}async toBuffer(t=196608){let i=await this.file.arrayBuffer(),e=new Uint8Array(i),s=[];for(let a=0;a<e.length;a+=t)s.push(e.slice(a,a+t));return{data:{destination:this.file.webkitRelativePath||null,lastModified:this.file.lastModified,originalname:this.file.name,mimetype:this.file.type,size:this.file.size},chunkSize:t,chunks:s}}}class ImageManager{ev=new EventListener;#a;#b=void 0;files=[];constructor(t,i={multi:!1,autohide:!1,justChange:!1}){this.input=t,this.#a=i,t.style.display="none",this.imgBox=document.createElement("section"),this.imgBox.classList.add("img-box","bx","bx-image"),this.isDisabled=t.hasAttribute("disabled"),this.upload=document.createElement("div"),this.upload.classList.add("upload"),this.upload.innerHTML=`<span>Subir (${t.accept})</span>`,this.upload.addEventListener("click",()=>this.input.click()),this.input.addEventListener("change",()=>this.create()),this.isDisabled?this.input.parentNode.append(this.imgBox):this.input.parentNode.append(this.imgBox,this.upload),document.addEventListener("keydown",({key:t})=>{if(this.#b){if("Escape"===t)return this.#c();"ArrowLeft"===t&&this.#a.multi&&this.#d("left"),"ArrowRight"===t&&this.#a.multi&&this.#d("right")}});let e=this.input.getAttribute("default");if(e)return this.imgBox.style.backgroundImage=`url(${e})`;let s=this.input.getAttribute("value");s&&this.charge(s),this.#a.autohide&&(this.upload.style.display="none")}state(t){t?(this.input.parentNode.append(this.upload),this.input.setAttribute("disabled","")):(this.upload.remove(),this.input.removeAttribute("disabled")),this.isDisabled=!t}#d(t){("left"===t||"right"===t)&&this.ev.emit(t,null)}#e(i){if(i.classList.contains("full-screen"))return this.#c();i.classList.add("full-screen"),this.#b=i,this.ev.emit("fullScreen",i)}#c(){this.#b&&(this.#b.classList.remove("full-screen"),this.#b=void 0,this.ev.emit("fullScreen",null))}create(){let t=this.input.files[0];if(t){let i=new DataImage(t),e=new FileReader;e.onload=t=>{let e=document.createElement("div");e.classList.add("img","upload");let s=document.createElement("img");if(s.src=t.target.result,e.addEventListener("click",()=>this.#e(e)),e.append(s),!this.#a.justChange){let a=document.createElement("a");a.innerHTML="<i class='bx bx-x'></i>",a.classList.add("close"),a.addEventListener("click",()=>this.#f(e,i)),e.append(a)}!this.#a.multi&&(this.empty(),this.ev.emit("change",e),this.#a.autohide&&(this.upload.style.display="none")),this.imgBox.append(e),this.files.push(i),this.ev.emit("insert",i)},e.readAsDataURL(t)}}#f(e,s){s&&(this.files=this.files.filter(t=>t!==s)),e.remove(),this.ev.emit("remove",e),!this.#a.multi&&this.#a.autohide&&(this.upload.style.display="")}empty(){this.files=[],this.imgBox.innerHTML="",!this.#a.multi&&this.#a.autohide&&(this.upload.style.display="")}charge(t){let i=document.createElement("div");i.classList.add("img","charge");let e=document.createElement("img");if(e.src=t,i.addEventListener("click",()=>this.#e(i)),i.append(e),!this.#a.justChange&&!this.isDisabled){let s=document.createElement("a");s.innerHTML="<i class='bx bx-x'></i>",s.classList.add("close"),s.addEventListener("click",()=>this.#f(i)),i.append(s)}!this.#a.multi&&(this.empty(),this.ev.emit("change",i),this.#a.autohide&&(this.upload.style.display="none")),this.imgBox.append(i)}}