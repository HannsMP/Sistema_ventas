class OptionsServerside{#a=!1;event=new EventListener;#b=new Map;#c=new Map;#d=20;#e=0;#f=0;#g=0;#h="";#i=e=>e;constructor(e,t={}){this.#i=e,this.options=t,this.wrapperBox=document.createElement("div"),this.wrapperBox.className="selector-wrapper",this.menuBox=document.createElement("div"),this.menuBox.className="selector-menu scroll-y",this.menuBox.innerHTML='<span class="menu-warn"></span>',this.footerBox=document.createElement("div"),this.footerBox.className="selector-footer",this.wrapperBox.append(this.menuBox,this.footerBox),this.menuBox.addEventListener("scroll",()=>{let{scrollTop:e,clientHeight:t,scrollHeight:s}=this.menuBox;e+t<s-1||this.#j()}),this.menuBox.addEventListener("click",e=>{let t=e.target.closest(".menu-index");if(!t)return;let s=parseInt(t.dataset.id);this.options.associative&&t.remove(),this.#k(s)})}reset(){this.#b.forEach(e=>e.closeAnchor.click())}search(e=""){this.#e=0,this.#h=e?.trim()||"",this.#c.clear(),this.menuBox.innerHTML="",this.#j()}draw(e){if(this.menuBox.innerHTML="",e)return this.#j(0,this.#d*this.#e);this.#c.forEach(e=>this.menuBox.append(this.#l(e.id,e.name,e.src)))}select(e){return new Promise(t=>{"number"==typeof e&&e!=NaN&&this.#i({search:e,byId:!0,start:0,length:1,order:"desc",noInclude:[]},({data:[s]})=>{if(!s)return;let i=this.#m(s.name),o=i.querySelector("a");o.addEventListener("click",()=>{this.event.emit("close",n),s.selected=0,i.remove(),this.#b.delete(e),this.#n()},{once:!0});let n={id:e,indexData:s,selectedBox:i,closeAnchor:o};this.#b.set(e,n),this.event.emit("select",n),s.selected=1,this.#n(),t(n)})})}set(e,t){if(this.#c.set(e,t),this.#b.has(e)){let s=this.#b.get(e);s.indexData=t,s.selectedBox.querySelector("span").textContent=t.name}}delete(e){this.#b.has(e)&&this.#b.get(e).closeAnchor.click(),this.#c.has(e)&&(this.#c.get(e).selectorBox?.remove(),this.#c.delete(e))}#j(e=this.#d*this.#e,t=this.#d){!this.#a&&(this.#f<e||(this.#a=!0,this.#i({start:e,length:t,byId:!1,search:this.#h,order:this.options.order||"desc",noInclude:this.options.noInclude?Array.from(this.#b.keys()):[]},e=>{e.data.forEach(e=>{e.selectorBox=this.#l(e.id,e.name,e.src),this.#c.set(e.id,e),this.menuBox.append(e.selectorBox)}),this.#f=e.recordsFiltered,this.#g=e.recordsTotal,this.#e++,this.#n(),this.#a=!1})))}#k(s){if(!this.#c.has(s))return;let i=this.#c.get(s);if(1===i.selected)return;let o=this.#m(i.name),n=o.querySelector("a");n.addEventListener("click",()=>{this.event.emit("close",l),i.selected=0,o.remove(),this.#b.delete(s),this.#n()},{once:!0});let l={id:s,indexData:i,selectedBox:o,closeAnchor:n};return this.#b.set(s,l),this.event.emit("click",l),i.selected=1,this.#n(),l}#m(c){let r=document.createElement("div");return r.innerHTML=`<span>${c}</span><a><i class="bx bx-x"></i></a>`,r}#l(h,a,d){let u=document.createElement("div");return u.dataset.id=h,u.className="menu-index",u.innerHTML=this.options.showIndex?"img"===this.options.showIndex?`<img src="${d}"><span>${a}</span>`:`<small>${h}</small><span>${a}</span>`:`<span>${a}</span>`,u}#n(){this.footerBox.innerHTML=`<small>Mostrando ${Math.min(this.#e*this.#d,this.#f)} de ${this.#f} filtrados</small><br><small>Total: ${this.#g}</small>`}}class SelectorInput extends EventListener{selected=[];constructor(e,t,s={}){if(!(e instanceof HTMLInputElement))throw TypeError("El elemento no es un input.");if(!(t instanceof OptionsServerside))throw TypeError("Se requiere una instancia de SelectorServerside.");if(super(),this.inputElement=e,this.selectorClass=t,this.options={multi:Boolean(s?.multi),autoHide:Boolean(s?.autohide),justChange:Boolean(s?.justChange)},this.isDisabled=e.disabled,e.insertAdjacentHTML("beforebegin",'<div class="selected-collection"></div>'),this.collectionBox=e.previousElementSibling,!this.isDisabled){t.event.on("click",e=>this.#o(e),{persistence:!0}),t.event.on("close",e=>this.#p(e),{persistence:!0}),e.setAttribute("autocomplete","off");let i;e.addEventListener("input",s=>{clearTimeout(i),i=setTimeout(()=>{this.emit("input",e.value),t.search(e.value)},300)}),e.addEventListener("focusin",s=>{this.emit("focusin",s),e.parentNode.append(t.wrapperBox),t.search(e.value)}),e.addEventListener("focusout",e=>{this.emit("focusout",e),setTimeout(()=>{t.wrapperBox.remove()},200)})}}#o(p){if(this.selectorClass.wrapperBox.parentNode===this.inputElement.parentNode){if(this.options.multi)this.selected.push(p);else{let m=this.selected[0];m&&(m.closeAnchor.click(),this.emit("change",m)),this.selected=[p]}this.collectionBox.append(p.selectedBox),this.emit("selected",p),this.inputElement.value="",this.options.autoHide&&(this.inputElement.style.display="none"),this.options.justChange&&!this.options.multi&&p.closeAnchor.remove()}}#p(x){if(x.selectedBox.closest(".selected-collection")===this.collectionBox){if(this.options.multi){let f=this.selected.findIndex(e=>e===x);-1!==f&&this.selected.splice(f,1)}else this.selected=[],this.options.autoHide&&(this.inputElement.style.display="");this.emit("deselected",x)}}async select(e){let t=await this.selectorClass.select(e=Number(e));if(this.options.multi)this.selected.push(t);else{let s=this.selected[0];s&&(s.closeAnchor.click(),this.emit("change",s,t)),this.selected=[t]}this.collectionBox.append(t.selectedBox),this.emit("selected",t),this.options.autoHide&&(this.inputElement.style.display="none"),this.options.justChange&&!this.options.multi&&t.closeAnchor.remove()}deselect(e){if((e=Number(e))!=NaN){if(this.options.multi){let t=this.selected.findIndex(t=>t.id===e);-1!=t&&(this.selected[t]?.closeAnchor.click(),this.selected.splice(t,1))}else{if(this.selected[0].id!=e&&!this.selected[0]?.closeAnchor)return;this.options.autoHide&&(this.inputElement.style.display=""),this.selected[0].closeAnchor.click()}}}empty(){this.selected.length&&this.selected.forEach(e=>e.closeAnchor.click())}}